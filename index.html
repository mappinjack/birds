<!DOCTYPE html>
<html>

<head>
    <title>Birds by Jack</title>
    <meta name="description" content="Learn your North American birds">
    <meta name="keywords" content="learn, birds, quiz">
    <meta name="author" content="Jack Forsyth">
    <meta charset="UTF-8">
    <script src="scripts/script.js"></script>
    <script src="scripts/birddict.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
        crossorigin="anonymous">
    <style>
        .wrapper {
            text-align:center;
        }

        #imagewrapper {
            margin:auto;
            height: 83vh;
            margin-top: 20px;
        }

        #imagewrapper.hidden {
            margin:auto;
            height: 83vh;
            margin-top: 20px;
            display: hidden;
        }

        #textwrapper {
            margin:auto;
            bottom:10px;
            position: relative;

        }

        #birdguess {
            font-family: 'Noto Sans SC', sans-serif;
        }

        #photocredit {
            vertical-align:middle;
            float:right;
            line-height:13vh;
        }

        input[type=text] {
            width: 50%;
            text-align: center;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            font-size: 24px;
            background-color: white;
            background-image: url('searchicon.png');
            background-position: 10px 10px; 
            background-repeat: no-repeat;
            padding: 12px 10px;
    }
        .header {
            height: 5vh;
        }


        #sourcediv {
            position:absolute;
            right:80px;
            bottom:5px;
            width:25px;
            font-family: 'Noto Sans SC', sans-serif;
            

        }

        #sourcediv a {
            color: black;
            font-family: 'Noto Sans SC', sans-serif;
            text-decoration: none;

        }

        #sourcediv a:hover {
            text-decoration: underline;
        }
        #infodiv {
            position:absolute;
            left:5px;
            top:5px;

        }

        #infodiv a{
            display: block;
            width:75px;
            height:75px;
        }

        /* Tooltip container */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        /* Tooltip text */
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: rgb(201, 201, 201);
            color: black;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            top: 50%;
            left: 50%;
            font-family: 'Noto Sans SC', sans-serif;
            /* Position the tooltip text - see examples below! */
            position: absolute;
            z-index: 1;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .tooltip:hover .tooltiptext {
            visibility: visible;
        }

         /* Customize the label (the container) */
        .container {
            display: block;
            position: relative;
            padding-left: 35px;
            margin-bottom: 12px;
            margin-top: 12px;
            margin-left: 12px;
            cursor: pointer;
            font-size: 22px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Hide the browser's default checkbox */
        .container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        p {
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        h2 {
            font-family: 'Noto Sans SC', sans-serif;
        }

        /* Create a custom checkbox */
        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 25px;
            width: 25px;
            background-color: #eee;
        }

        /* On mouse-over, add a grey background color */
        .container:hover input ~ .checkmark {
            background-color: rgba(167, 167, 167, 0.63);
        }

        /* When the checkbox is checked, add a blue background */
        .container input:checked ~ .checkmark {
            background-color: #2196F3;
        }

        /* Create the checkmark/indicator (hidden when not checked) */
        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        /* Show the checkmark when checked */
        .container input:checked ~ .checkmark:after {
            display: block;
        }

        /* Style the checkmark/indicator */
        .container .checkmark:after {
            left: 9px;
            top: 5px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        } 

        #audiospot {
            display: none;
        }

/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 100px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
    position: relative;
    background-color: #fefefe;
    margin: auto;
    padding: 0;
    border: 1px solid #888;
    width: 80%;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
    -webkit-animation-name: animatetop;
    -webkit-animation-duration: 0.4s;
    animation-name: animatetop;
    animation-duration: 0.4s
}

/* Add Animation */
@-webkit-keyframes animatetop {
    from {top:-300px; opacity:0} 
    to {top:0; opacity:1}
}

@keyframes animatetop {
    from {top:-300px; opacity:0}
    to {top:0; opacity:1}
}

/* The Close Button */
.close {
    color: white;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}

.modal-header {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
}

.modal-body {padding: 2px 16px;}

.modal-footer {
    padding: 2px 16px;
    background-color: #5cb85c;
    color: white;
}

    </style>
</head>

<body>
    <!--<div class="header"><h1 style="font-family: 'Noto Sans SC', sans-serif;">Bird quiz</h1></div>-->
    <div id="infodiv" class="tooltip"><i style="font-size:40;opacity:0.2;" class="fas fa-question fa-3x"></i>
        <span class="tooltiptext">
            <label onclick=checkButton() class="container">Visual Clues
                <input id="visualcheck" type="checkbox" checked="checked">
                <span class="checkmark"></span>
            </label>

            <label onclick=checkButton() class="container">Audio Clues
                <input id="audiocheck" type="checkbox">
                <span class="checkmark"></span>
            </label>
            <label id="helpbutton" class="container help" style="right:25px;">Help
            </label>

        </span></div>
    <div class="wrapper">
        <div id="imagewrapper">
        </div>
        <div id="textwrapper">
            <input id="birdguess" type="text" name="birdguess" autocomplete="off" placeholder="Enter bird species here">
            <div id="sourcediv" class="sourcetip">
                <a id="imagesource" href='' target="_blank">Photo credit</a></div>
        </div>
    </div>
    <div id="audiowrapper">
        <audio src="//:0" autoplay loop></audio>
    </div>

    <div id="myModal" class="modal">

            <!-- Modal content -->
            <div class="modal-content">
              <div class="modal-header">
                <span class="close">&times;</span>
                <h2>So you want to learn some birds...</h2>
              </div>
              <div class="modal-body">
                <p>This site has been created to help aspiring birders brush up on their visual and audio bird identification.</p>
                <p>Try toggling on or off the visual or audio clues to add different ways to learn and challenge yourself.</p>
                <p>If you're stuck at any point along the way, simply type "hint" in the guess box to get some help.</p>
              </div>
            </div>
          
          </div>


    <script>
        var birddict = birdDict;
        var birdnames = [];
        var currentName;
        var alternatenames;
        for (var k in birdDict) birdnames.push(k);
        shuffleArray(birdnames)

        function loadNextBird() {
            if (birdnames.length == 0) {
                $('#imagewrapper').html('<p>You got them all! Click on the bird to start over.</p><i style="font-size:40;top:100px;"onclick="reloadPage()" class="fas fa-crow fa-10x"></i>')
                $('#audiowrapper').html('')
                return;
            }
            currentName = birdnames.pop()
            fullName = birddict[currentName]['name']
            alternatenames = [birddict[currentName]['name']].concat(birddict[currentName]['alternatenames']).map(v => v.toLowerCase());
            imagepaths = birddict[currentName]['images']
            shuffleArray(imagepaths) // randomize image
            imagepath = imagepaths[0]['name']
            sourcepath = imagepaths[0]['source']
            audiopaths = birddict[currentName]['sounds']
            document.getElementById('imagesource').href = sourcepath
            toggleAV()

        }

        function toggleAV() {
            if (visual == true) {
                $('#imagewrapper').html('<img src="images/{imagepath}" height="80%">'.replace('{imagepath}', imagepath));
            }
            else {
                $('#imagewrapper').html('');
            }

            if (audio == true) {
                $('#audiowrapper').html('<audio src="audio/{audiopath}" autoplay loop></audio>'.replace('{audiopath}', audiopaths[0]));
            }
            else {
                $('#audiowrapper').html('')
            }
        }

        var visual = document.getElementById('visualcheck').checked
        var audio = document.getElementById('audiocheck').checked


        function checkButton() {
            visual = document.getElementById('visualcheck').checked
            audio = document.getElementById('audiocheck').checked
            toggleAV()
        }


        $("#birdguess").keyup(function (e) {
            var guess = $(this).val();
            //stopHinting();


            if (alternatenames.includes(guess.toLowerCase())) {
                e.currentTarget.value = ""
                e.currentTarget.placeholder = ""
                loadNextBird()
            }
            else if (guess.toLowerCase() == 'hint') {
                e.currentTarget.value = ""
                hintTimer()
                hinting = true


            }
        });

        $("#birdguess").keydown(function (e) {
            if (hinting == true) {
                hinting = false
                stopHinting()
            }
        })
        hinting = false

        function stopHinting() {
            var id = window.setTimeout(function () { }, 0);
            while (id--) {
                window.clearTimeout(id);
                // will do nothing if no timeout with id is present
            }
            inputBox = document.getElementById('birdguess')
            value = inputBox.value
            lastChar = value.slice(-1)
            trimString = value.slice(0, -2)
            inputBox.value = value.slice(0, sliceLocation)
            sliceLocation = 0
        }

        function hintTimer() {
            for (var i = 1; i <= fullName.length; ++i)
                doScaledTimeout(i);
        }
        sliceLocation = 0

        function doScaledTimeout(i) {
            setTimeout(function () {
                var inputBox = document.getElementById('birdguess')
                inputBox.value = fullName.slice(0, i) + fullName.slice(i).replace(/([a-zA-Z])/g, "-")
                if (inputBox.value == fullName) {
                    loadNextBird()
                    inputBox.value = ''
                    sliceLocation = 0
                }
                sliceLocation = i
            }, (i - 1) * 600);
        }

        loadNextBird()
        document.getElementById('birdguess').focus();

        function reloadPage() {
            location.reload()
        }

        // Get the modal
        var modal = document.getElementById('myModal');

        // Get the button that opens the modal
        var btn = document.getElementById("helpbutton");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal 
        btn.onclick = function () {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }


    </script>
</body>

</html>